FROM node:18-alpine

WORKDIR /app

# Copiar package.json do backend
COPY backend/package*.json ./
RUN npm install --production

# Copiar cÃ³digo do backend
COPY backend/ ./

# Debug: verificar estrutura de arquivos
RUN ls -la ./
RUN ls -la ./database/ || echo "Pasta database nÃ£o existe"
RUN ls -la ./middleware/ || echo "Pasta middleware nÃ£o existe"

# Criar pasta do banco se nÃ£o existir
RUN mkdir -p ./database

EXPOSE 3001

# Verificar se os mÃ³dulos existem sem executar
RUN node -e "console.log('âœ… Verificando mÃ³dulos...'); require('express'); require('sqlite3'); console.log('âœ… MÃ³dulos principais OK');"

# Tentar execuÃ§Ã£o direta primeiro
CMD ["sh", "-c", "echo 'ğŸš€ Container iniciado!' && echo 'ğŸ“ PWD:' && pwd && echo 'ğŸ“‚ Arquivos:' && ls -la && echo 'ğŸš€ Iniciando Node.js...' && node server.js"]
